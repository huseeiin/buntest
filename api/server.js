// @bun
import{existsSync as p$} from"fs";var H$=($)=>{let J=$.filename;if(/(?:^|[\/\\])\.\.(?:$|[\/\\])/.test(J))return;let z=$.root||"";const Z=$.defaultDocument||"index.html";if(J.endsWith("/"))J=J.concat(Z);else if(!J.match(/\.[a-zA-Z0-9]+$/))J=J.concat("/"+Z);J=J.replace(/^\.?[\/\\]/,""),J=J.replace(/\\/,"/"),z=z.replace(/\/$/,"");let Y=z?z+"/"+J:J;return Y=Y.replace(/^\.?\//,""),Y};var D$=($)=>{const J=/\.([a-zA-Z0-9]+?)$/,z=$.match(J);if(!z)return;let Z=s$[z[1]];if(Z&&Z.startsWith("text")||Z==="application/json")Z+="; charset=utf-8";return Z},s$={aac:"audio/aac",abw:"application/x-abiword",arc:"application/x-freearc",avi:"video/x-msvideo",avif:"image/avif",av1:"video/av1",azw:"application/vnd.amazon.ebook",bin:"application/octet-stream",bmp:"image/bmp",bz:"application/x-bzip",bz2:"application/x-bzip2",csh:"application/x-csh",css:"text/css",csv:"text/csv",doc:"application/msword",docx:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",eot:"application/vnd.ms-fontobject",epub:"application/epub+zip",gif:"image/gif",gz:"application/gzip",htm:"text/html",html:"text/html",ico:"image/x-icon",ics:"text/calendar",jar:"application/java-archive",jpeg:"image/jpeg",jpg:"image/jpeg",js:"text/javascript",json:"application/json",jsonld:"application/ld+json",map:"application/json",mid:"audio/x-midi",midi:"audio/x-midi",mjs:"text/javascript",mp3:"audio/mpeg",mp4:"video/mp4",mpeg:"video/mpeg",mpkg:"application/vnd.apple.installer+xml",odp:"application/vnd.oasis.opendocument.presentation",ods:"application/vnd.oasis.opendocument.spreadsheet",odt:"application/vnd.oasis.opendocument.text",oga:"audio/ogg",ogv:"video/ogg",ogx:"application/ogg",opus:"audio/opus",otf:"font/otf",pdf:"application/pdf",php:"application/php",png:"image/png",ppt:"application/vnd.ms-powerpoint",pptx:"application/vnd.openxmlformats-officedocument.presentationml.presentation",rtf:"application/rtf",sh:"application/x-sh",svg:"image/svg+xml",swf:"application/x-shockwave-flash",tar:"application/x-tar",tif:"image/tiff",tiff:"image/tiff",ts:"video/mp2t",ttf:"font/ttf",txt:"text/plain",vsd:"application/vnd.visio",wasm:"application/wasm",webm:"video/webm",weba:"audio/webm",webp:"image/webp",woff:"font/woff",woff2:"font/woff2",xhtml:"application/xhtml+xml",xls:"application/vnd.ms-excel",xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",xml:"application/xml",xul:"application/vnd.mozilla.xul+xml",zip:"application/zip","3gp":"video/3gpp","3g2":"video/3gpp2","7z":"application/x-7z-compressed",gltf:"model/gltf+json",glb:"model/gltf-binary"};var{file:o$}=Bun,r$="index.html",$$=($={root:""})=>{return async(J,z)=>{if(J.finalized){await z();return}const Z=new URL(J.req.url),Y=$.path??decodeURI(Z.pathname);let Q=H$({filename:$.rewriteRequestPath?$.rewriteRequestPath(Y):Y,root:$.root,defaultDocument:r$});if(!Q)return await z();if(Q=`./${Q}`,p$(Q)){const V=o$(Q);if(V){const W=D$(Q);if(W)J.header("Content-Type",W);return J.body(V)}}await $.onNotFound?.(Q,J),await z();return}};var Z$=($)=>{const J=$.split("/");if(J[0]==="")J.shift();return J},N$=($)=>{const{groups:J,path:z}=a$($),Z=Z$(z);return t$(Z,J)},a$=($)=>{const J=[];return $=$.replace(/\{[^}]+\}/g,(z,Z)=>{const Y=`@${Z}`;return J.push([Y,z]),Y}),{groups:J,path:$}},t$=($,J)=>{for(let z=J.length-1;z>=0;z--){const[Z]=J[z];for(let Y=$.length-1;Y>=0;Y--)if($[Y].includes(Z)){$[Y]=$[Y].replace(Z,J[z][1]);break}}return $},h={},z$=($)=>{if($==="*")return"*";const J=$.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/);if(J){if(!h[$])if(J[2])h[$]=[$,J[1],new RegExp("^"+J[2]+"$")];else h[$]=[$,J[1],!0];return h[$]}return null},Y$=($)=>{const J=$.url.match(/^https?:\/\/[^/]+(\/[^?]*)/);return J?J[1]:""},A$=($)=>{const J=$.indexOf("?",8);return J===-1?"":"?"+$.slice(J+1)},T$=($)=>{const J=Y$($);return J.length>1&&J[J.length-1]==="/"?J.slice(0,-1):J},C=(...$)=>{let J="",z=!1;for(let Z of $){if(J[J.length-1]==="/")J=J.slice(0,-1),z=!0;if(Z[0]!=="/")Z=`/${Z}`;if(Z==="/"&&z)J=`${J}/`;else if(Z!=="/")J=`${J}${Z}`;if(Z==="/"&&J==="")J="/"}return J},d=($)=>{if(!$.match(/\:.+\?$/))return null;const J=$.split("/"),z=[];let Z="";return J.forEach((Y)=>{if(Y!==""&&!/\:/.test(Y))Z+="/"+Y;else if(/\:/.test(Y))if(/\?/.test(Y)){if(z.length===0&&Z==="")z.push("/");else z.push(Z);const Q=Y.replace("?","");Z+="/"+Q,z.push(Z)}else Z+="/"+Y}),z.filter((Y,Q,V)=>V.indexOf(Y)===Q)},J$=($)=>{if(!/[%+]/.test($))return $;if($.indexOf("+")!==-1)$=$.replace(/\+/g," ");return/%/.test($)?S($):$},G$=($,J,z)=>{let Z;if(!z&&J&&!/[%+]/.test(J)){let V=$.indexOf(`?${J}`,8);if(V===-1)V=$.indexOf(`&${J}`,8);while(V!==-1){const W=$.charCodeAt(V+J.length+1);if(W===61){const U=V+J.length+2,X=$.indexOf("&",U);return J$($.slice(U,X===-1?void 0:X))}else if(W==38||isNaN(W))return"";V=$.indexOf(`&${J}`,V+1)}if(Z=/[%+]/.test($),!Z)return}const Y={};Z??(Z=/[%+]/.test($));let Q=$.indexOf("?",8);while(Q!==-1){const V=$.indexOf("&",Q+1);let W=$.indexOf("=",Q);if(W>V&&V!==-1)W=-1;let U=$.slice(Q+1,W===-1?V===-1?void 0:V:W);if(Z)U=J$(U);if(Q=V,U==="")continue;let X;if(W===-1)X="";else if(X=$.slice(W+1,V===-1?void 0:V),Z)X=J$(X);if(z){if(!(Y[U]&&Array.isArray(Y[U])))Y[U]=[];Y[U].push(X)}else Y[U]??(Y[U]=X)}return J?Y[J]:Y},I$=G$,P$=($,J)=>{return G$($,J,!0)},S=decodeURIComponent;var e$=/^[\w!#$%&'*.^`|~+-]+$/,$0=/^[ !#-:<-[\]-~]*$/,E$=($,J)=>{return $.trim().split(";").reduce((Z,Y)=>{Y=Y.trim();const Q=Y.indexOf("=");if(Q===-1)return Z;const V=Y.substring(0,Q).trim();if(J&&J!==V||!e$.test(V))return Z;let W=Y.substring(Q+1).trim();if(W.startsWith('"')&&W.endsWith('"'))W=W.slice(1,-1);if($0.test(W))Z[V]=S(W);return Z},{})};var J0=($,J,z={})=>{let Z=`${$}=${J}`;if(z&&typeof z.maxAge==="number"&&z.maxAge>=0)Z+=`; Max-Age=${Math.floor(z.maxAge)}`;if(z.domain)Z+=`; Domain=${z.domain}`;if(z.path)Z+=`; Path=${z.path}`;if(z.expires)Z+=`; Expires=${z.expires.toUTCString()}`;if(z.httpOnly)Z+="; HttpOnly";if(z.secure)Z+="; Secure";if(z.sameSite)Z+=`; SameSite=${z.sameSite}`;if(z.partitioned)Z+="; Partitioned";return Z},R$=($,J,z={})=>{return J=encodeURIComponent(J),J0($,J,z)};var j$=($,J)=>{const z=new String($);return z.isEscaped=!0,z.callbacks=J,z};var f$={Stringify:1,BeforeStream:2,Stream:3};var Q$=async($,J,z,Z,Y)=>{const Q=$.callbacks;if(!Q?.length)return Promise.resolve($);if(Y)Y[0]+=$;else Y=[$];const V=Promise.all(Q.map((W)=>W({phase:J,buffer:Y,context:Z}))).then((W)=>Promise.all(W.filter(Boolean).map((U)=>Q$(U,J,!1,Z,Y))).then(()=>Y[0]));if(z)return j$(await V,Q);else return V};var C$=class{constructor($,J){this.abortSubscribers=[],this.writable=$,this.writer=$.getWriter(),this.encoder=new TextEncoder;const z=J.getReader();this.responseReadable=new ReadableStream({async pull(Z){const{done:Y,value:Q}=await z.read();Y?Z.close():Z.enqueue(Q)},cancel:()=>{this.abortSubscribers.forEach((Z)=>Z())}})}async write($){try{if(typeof $==="string")$=this.encoder.encode($);await this.writer.write($)}catch(J){}return this}async writeln($){return await this.write($+"\n"),this}sleep($){return new Promise((J)=>setTimeout(J,$))}async close(){try{await this.writer.close()}catch($){}}async pipe($){this.writer.releaseLock(),await $.pipeTo(this.writable,{preventClose:!0}),this.writer=this.writable.getWriter()}async onAbort($){this.abortSubscribers.push($)}};var y$=($,J,z)=>{if(!J.has($))throw TypeError("Cannot "+z)},F=($,J,z)=>{return y$($,J,"read from private field"),z?z.call($):J.get($)},y=($,J,z)=>{if(J.has($))throw TypeError("Cannot add the same private member more than once");J instanceof WeakSet?J.add($):J.set($,z)},H=($,J,z,Z)=>{return y$($,J,"write to private field"),Z?Z.call($,z):J.set($,z),z},S$="text/plain; charset=UTF-8",V$=($,J={})=>{return Object.entries(J).forEach(([z,Z])=>$.set(z,Z)),$},v,R,M,q,A,j,x=class{constructor($,J){if(this.env={},this._var={},this.finalized=!1,this.error=void 0,y(this,v,200),y(this,R,void 0),y(this,M,void 0),y(this,q,void 0),y(this,A,void 0),y(this,j,!0),this.renderer=(z)=>this.html(z),this.notFoundHandler=()=>new Response,this.render=(...z)=>this.renderer(...z),this.setRenderer=(z)=>{this.renderer=z},this.header=(z,Z,Y)=>{if(Z===void 0){if(F(this,M))F(this,M).delete(z);else if(F(this,q))delete F(this,q)[z.toLocaleLowerCase()];if(this.finalized)this.res.headers.delete(z);return}if(Y?.append){if(!F(this,M))H(this,j,!1),H(this,M,new Headers(F(this,q))),H(this,q,{});F(this,M).append(z,Z)}else if(F(this,M))F(this,M).set(z,Z);else F(this,q)??H(this,q,{}),F(this,q)[z.toLowerCase()]=Z;if(this.finalized)if(Y?.append)this.res.headers.append(z,Z);else this.res.headers.set(z,Z)},this.status=(z)=>{H(this,j,!1),H(this,v,z)},this.set=(z,Z)=>{this._var??(this._var={}),this._var[z]=Z},this.get=(z)=>{return this._var?this._var[z]:void 0},this.newResponse=(z,Z,Y)=>{if(F(this,j)&&!Y&&!Z&&F(this,v)===200)return new Response(z,{headers:F(this,q)});if(Z&&typeof Z!=="number"){const V=V$(new Headers(Z.headers),F(this,q));return new Response(z,{headers:V,status:Z.status})}const Q=typeof Z==="number"?Z:F(this,v);if(F(this,q)??H(this,q,{}),F(this,M)??H(this,M,new Headers),V$(F(this,M),F(this,q)),F(this,A))F(this,A).headers.forEach((V,W)=>{F(this,M)?.set(W,V)}),V$(F(this,M),F(this,q));Y??(Y={});for(let[V,W]of Object.entries(Y))if(typeof W==="string")F(this,M).set(V,W);else{F(this,M).delete(V);for(let U of W)F(this,M).append(V,U)}return new Response(z,{status:Q,headers:F(this,M)})},this.body=(z,Z,Y)=>{return typeof Z==="number"?this.newResponse(z,Z,Y):this.newResponse(z,Z)},this.text=(z,Z,Y)=>{if(!F(this,q)){if(F(this,j)&&!Y&&!Z)return new Response(z);H(this,q,{})}return F(this,q)["content-type"]=S$,typeof Z==="number"?this.newResponse(z,Z,Y):this.newResponse(z,Z)},this.json=(z,Z,Y)=>{const Q=JSON.stringify(z);return F(this,q)??H(this,q,{}),F(this,q)["content-type"]="application/json; charset=UTF-8",typeof Z==="number"?this.newResponse(Q,Z,Y):this.newResponse(Q,Z)},this.jsonT=(z,Z,Y)=>{return this.json(z,Z,Y)},this.html=(z,Z,Y)=>{if(F(this,q)??H(this,q,{}),F(this,q)["content-type"]="text/html; charset=UTF-8",typeof z==="object"){if(!(z instanceof Promise))z=z.toString();if(z instanceof Promise)return z.then((Q)=>Q$(Q,f$.Stringify,!1,{})).then((Q)=>{return typeof Z==="number"?this.newResponse(Q,Z,Y):this.newResponse(Q,Z)})}return typeof Z==="number"?this.newResponse(z,Z,Y):this.newResponse(z,Z)},this.redirect=(z,Z=302)=>{return F(this,M)??H(this,M,new Headers),F(this,M).set("Location",z),this.newResponse(null,Z)},this.streamText=(z,Z,Y)=>{return Y??(Y={}),this.header("content-type",S$),this.header("x-content-type-options","nosniff"),this.header("transfer-encoding","chunked"),this.stream(z,Z,Y)},this.stream=(z,Z,Y)=>{const{readable:Q,writable:V}=new TransformStream,W=new C$(V,Q);return z(W).finally(()=>W.close()),typeof Z==="number"?this.newResponse(W.responseReadable,Z,Y):this.newResponse(W.responseReadable,Z)},this.cookie=(z,Z,Y)=>{const Q=R$(z,Z,Y);this.header("set-cookie",Q,{append:!0})},this.notFound=()=>{return this.notFoundHandler(this)},this.req=$,J){if(H(this,R,J.executionCtx),this.env=J.env,J.notFoundHandler)this.notFoundHandler=J.notFoundHandler}}get event(){if(F(this,R)&&"respondWith"in F(this,R))return F(this,R);else throw Error("This context has no FetchEvent")}get executionCtx(){if(F(this,R))return F(this,R);else throw Error("This context has no ExecutionContext")}get res(){return H(this,j,!1),F(this,A)||H(this,A,new Response("404 Not Found",{status:404}))}set res($){if(H(this,j,!1),F(this,A)&&$){F(this,A).headers.delete("content-type");for(let[J,z]of F(this,A).headers.entries())if(J==="set-cookie"){const Z=F(this,A).headers.getSetCookie();$.headers.delete("set-cookie");for(let Y of Z)$.headers.append("set-cookie",Y)}else $.headers.set(J,z)}H(this,A,$),this.finalized=!0}get var(){return{...this._var}}get runtime(){const $=globalThis;if($?.Deno!==void 0)return"deno";if($?.Bun!==void 0)return"bun";if(typeof $?.WebSocketPair==="function")return"workerd";if(typeof $?.EdgeRuntime==="string")return"edge-light";if($?.fastly!==void 0)return"fastly";if($?.__lagon__!==void 0)return"lagon";if($?.process?.release?.name==="node")return"node";return"other"}};v=new WeakMap;R=new WeakMap;M=new WeakMap;q=new WeakMap;A=new WeakMap;j=new WeakMap;var U$=($,J,z)=>{return(Z,Y)=>{let Q=-1;return V(0);async function V(W){if(W<=Q)throw new Error("next() called multiple times");Q=W;let U,X=!1,K;if($[W]){if(K=$[W][0][0],Z instanceof x)Z.req.routeIndex=W}else K=W===$.length&&Y||void 0;if(!K){if(Z instanceof x&&Z.finalized===!1&&z)U=await z(Z)}else try{U=await K(Z,()=>{return V(W+1)})}catch(B){if(B instanceof Error&&Z instanceof x&&J)Z.error=B,U=await J(B,Z),X=!0;else throw B}if(U&&(Z.finalized===!1||X))Z.res=U;return Z}}};var x$=class extends Error{constructor($=500,J){super(J?.message);this.res=J?.res,this.status=$}getResponse(){if(this.res)return this.res;return new Response(this.message,{status:this.status})}};var Z0=function($){if($===null)return!1;return $.startsWith("multipart/form-data")||$.startsWith("application/x-www-form-urlencoded")};async function z0($,J){const z=await $.formData();if(z)return Y0(z,J);return{}}var Y0=function($,J){const z={};return $.forEach((Z,Y)=>{if(!(J.all||Y.endsWith("[]")))z[Y]=Z;else Q0(z,Y,Z)}),z},V0=function($){return Array.isArray($)},g$=async($,J={all:!1})=>{const z=$.headers.get("Content-Type");if(Z0(z))return z0($,J);return{}},Q0=($,J,z)=>{if($[J]&&V0($[J]))U0($[J],z);else if($[J])W0($,J,z);else $[J]=z},U0=($,J)=>{$.push(J)},W0=($,J,z)=>{$[J]=[$[J],z]};var v$=($,J,z)=>{if(!J.has($))throw TypeError("Cannot "+z)},G=($,J,z)=>{return v$($,J,"read from private field"),z?z.call($):J.get($)},k$=($,J,z)=>{if(J.has($))throw TypeError("Cannot add the same private member more than once");J instanceof WeakSet?J.add($):J.set($,z)},b$=($,J,z,Z)=>{return v$($,J,"write to private field"),Z?Z.call($,z):J.set($,z),z},_,T,_$=class{constructor($,J="/",z=[[]]){k$(this,_,void 0),k$(this,T,void 0),this.routeIndex=0,this.bodyCache={},this.cachedBody=(Z)=>{const{bodyCache:Y,raw:Q}=this,V=Y[Z];if(V)return V;if(Y.arrayBuffer)return(async()=>{return await new Response(Y.arrayBuffer)[Z]()})();return Y[Z]=Q[Z]()},this.raw=$,this.path=J,b$(this,T,z),b$(this,_,{})}param($){return $?this.getDecodedParam($):this.getAllDecodedParams()}getDecodedParam($){const J=G(this,T)[0][this.routeIndex][1][$],z=this.getParamValue(J);return z?/\%/.test(z)?S(z):z:void 0}getAllDecodedParams(){const $={},J=Object.keys(G(this,T)[0][this.routeIndex][1]);for(let z of J){const Z=this.getParamValue(G(this,T)[0][this.routeIndex][1][z]);if(Z&&typeof Z==="string")$[z]=/\%/.test(Z)?S(Z):Z}return $}getParamValue($){return G(this,T)[1]?G(this,T)[1][$]:$}query($){return I$(this.url,$)}queries($){return P$(this.url,$)}header($){if($)return this.raw.headers.get($.toLowerCase())??void 0;const J={};return this.raw.headers.forEach((z,Z)=>{J[Z]=z}),J}cookie($){const J=this.raw.headers.get("Cookie");if(!J)return;const z=E$(J);if($)return z[$];else return z}async parseBody($){if(this.bodyCache.parsedBody)return this.bodyCache.parsedBody;const J=await g$(this,$);return this.bodyCache.parsedBody=J,J}json(){return this.cachedBody("json")}text(){return this.cachedBody("text")}arrayBuffer(){return this.cachedBody("arrayBuffer")}blob(){return this.cachedBody("blob")}formData(){return this.cachedBody("formData")}addValidatedData($,J){G(this,_)[$]=J}valid($){return G(this,_)[$]}get url(){return this.raw.url}get method(){return this.raw.method}get matchedRoutes(){return G(this,T)[0].map(([[,$]])=>$)}get routePath(){return G(this,T)[0].map(([[,$]])=>$)[this.routeIndex].path}get headers(){return this.raw.headers}get body(){return this.raw.body}get bodyUsed(){return this.raw.bodyUsed}get integrity(){return this.raw.integrity}get keepalive(){return this.raw.keepalive}get referrer(){return this.raw.referrer}get signal(){return this.raw.signal}};_=new WeakMap;T=new WeakMap;var w="ALL",c$="all",n=["get","post","put","delete","options","patch"],s="Can not add a route since the matcher is already built.",p=class extends Error{};var F0=function(){return class{}},i$=($,J,z)=>{if(!J.has($))throw TypeError("Cannot "+z)},o=($,J,z)=>{return i$($,J,"read from private field"),z?z.call($):J.get($)},X0=($,J,z)=>{if(J.has($))throw TypeError("Cannot add the same private member more than once");J instanceof WeakSet?J.add($):J.set($,z)},W$=($,J,z,Z)=>{return i$($,J,"write to private field"),Z?Z.call($,z):J.set($,z),z},K0=Symbol("composedHandler"),B0=($)=>{return $.text("404 Not Found",404)},u$=($,J)=>{if($ instanceof x$)return $.getResponse();console.error($);const z="Internal Server Error";return J.text(z,500)},I,m$=class extends F0(){constructor($={}){super();this._basePath="/",X0(this,I,"/"),this.routes=[],this.notFoundHandler=B0,this.errorHandler=u$,this.onError=(Z)=>{return this.errorHandler=Z,this},this.notFound=(Z)=>{return this.notFoundHandler=Z,this},this.head=()=>{return console.warn("`app.head()` is no longer used. `app.get()` implicitly handles the HEAD method."),this},this.handleEvent=(Z)=>{return this.dispatch(Z.request,Z,void 0,Z.request.method)},this.fetch=(Z,Y,Q)=>{return this.dispatch(Z,Q,Y,Z.method)},this.request=(Z,Y,Q,V)=>{if(Z instanceof Request){if(Y!==void 0)Z=new Request(Z,Y);return this.fetch(Z,Q,V)}Z=Z.toString();const W=/^https?:\/\//.test(Z)?Z:`http://localhost${C("/",Z)}`,U=new Request(W,Y);return this.fetch(U,Q,V)},this.fire=()=>{addEventListener("fetch",(Z)=>{Z.respondWith(this.dispatch(Z.request,Z,void 0,Z.request.method))})},[...n,c$].map((Z)=>{this[Z]=(Y,...Q)=>{if(typeof Y==="string")W$(this,I,Y);else this.addRoute(Z,o(this,I),Y);return Q.map((V)=>{if(typeof V!=="string")this.addRoute(Z,o(this,I),V)}),this}}),this.on=(Z,Y,...Q)=>{if(!Z)return this;W$(this,I,Y);for(let V of[Z].flat())Q.map((W)=>{this.addRoute(V.toUpperCase(),o(this,I),W)});return this},this.use=(Z,...Y)=>{if(typeof Z==="string")W$(this,I,Z);else Y.unshift(Z);return Y.map((Q)=>{this.addRoute(w,o(this,I),Q)}),this};const z=$.strict??!0;delete $.strict,Object.assign(this,$),this.getPath=z?$.getPath??Y$:T$}clone(){const $=new m$({router:this.router,getPath:this.getPath});return $.routes=this.routes,$}route($,J){const z=this.basePath($);if(!J)return z;return J.routes.map((Z)=>{let Y;if(J.errorHandler===u$)Y=Z.handler;else Y=async(Q,V)=>(await U$([],J.errorHandler)(Q,()=>Z.handler(Q,V))).res,Y[K0]=Z.handler;z.addRoute(Z.method,Z.path,Y)}),this}basePath($){const J=this.clone();return J._basePath=C(this._basePath,$),J}showRoutes(){this.routes.map((J)=>{console.log(`\x1B[32m${J.method}\x1B[0m ${" ".repeat(8-J.method.length)} ${J.path}`)})}mount($,J,z){const Z=C(this._basePath,$),Y=Z==="/"?0:Z.length,Q=async(V,W)=>{let U=void 0;try{U=V.executionCtx}catch{}const X=z?z(V):[V.env,U],K=Array.isArray(X)?X:[X],B=A$(V.req.url),O=await J(new Request(new URL((V.req.path.slice(Y)||"/")+B,V.req.url),V.req.raw),...K);if(O)return O;await W()};return this.addRoute(w,C($,"*"),Q),this}get routerName(){return this.matchRoute("GET","/"),this.router.name}addRoute($,J,z){$=$.toUpperCase(),J=C(this._basePath,J);const Z={path:J,method:$,handler:z};this.router.add($,J,[z,Z]),this.routes.push(Z)}matchRoute($,J){return this.router.match($,J)}handleError($,J){if($ instanceof Error)return this.errorHandler($,J);throw $}dispatch($,J,z,Z){if(Z==="HEAD")return(async()=>new Response(null,await this.dispatch($,J,z,"GET")))();const Y=this.getPath($,{env:z}),Q=this.matchRoute(Z,Y),V=new x(new _$($,Y,Q),{env:z,executionCtx:J,notFoundHandler:this.notFoundHandler});if(Q[0].length===1){let U;try{U=Q[0][0][0][0](V,async()=>{V.res=await this.notFoundHandler(V)})}catch(X){return this.handleError(X,V)}return U instanceof Promise?U.then((X)=>X||(V.finalized?V.res:this.notFoundHandler(V))).catch((X)=>this.handleError(X,V)):U}const W=U$(Q[0],this.errorHandler,this.notFoundHandler);return(async()=>{try{const U=await W(V);if(!U.finalized)throw new Error("Context is not finalized. You may forget returning Response object or `await next()`");return U.res}catch(U){return this.handleError(U,V)}})()}},l$=m$;I=new WeakMap;var q0=function($,J){if($.length===1)return J.length===1?$<J?-1:1:-1;if(J.length===1)return 1;if($===c||$===u)return 1;else if(J===c||J===u)return-1;if($===r)return 1;else if(J===r)return-1;return $.length===J.length?$<J?-1:1:J.length-$.length},r="[^/]+",c=".*",u="(?:|/.*)",g=Symbol(),a=class{constructor(){this.children={}}insert($,J,z,Z,Y){if($.length===0){if(this.index!==void 0)throw g;if(Y)return;this.index=J;return}const[Q,...V]=$,W=Q==="*"?V.length===0?["","",c]:["","",r]:Q==="/*"?["","",u]:Q.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/);let U;if(W){const X=W[1];let K=W[2]||r;if(X&&W[2]){if(K=K.replace(/^\((?!\?:)(?=[^)]+\)$)/,"(?:"),/\((?!\?:)/.test(K))throw g}if(U=this.children[K],!U){if(Object.keys(this.children).some((B)=>B!==c&&B!==u))throw g;if(Y)return;if(U=this.children[K]=new a,X!=="")U.varIndex=Z.varIndex++}if(!Y&&X!=="")z.push([X,U.varIndex])}else if(U=this.children[Q],!U){if(Object.keys(this.children).some((X)=>X.length>1&&X!==c&&X!==u))throw g;if(Y)return;U=this.children[Q]=new a}U.insert(V,J,z,Z,Y)}buildRegExpStr(){const J=Object.keys(this.children).sort(q0).map((z)=>{const Z=this.children[z];return(typeof Z.varIndex==="number"?`(${z})@${Z.varIndex}`:z)+Z.buildRegExpStr()});if(typeof this.index==="number")J.unshift(`#${this.index}`);if(J.length===0)return"";if(J.length===1)return J[0];return"(?:"+J.join("|")+")"}};var h$=class{constructor(){this.context={varIndex:0},this.root=new a}insert($,J,z){const Z=[],Y=[];for(let V=0;;){let W=!1;if($=$.replace(/\{[^}]+\}/g,(U)=>{const X=`@\\${V}`;return Y[V]=[X,U],V++,W=!0,X}),!W)break}const Q=$.match(/(?::[^\/]+)|(?:\/\*$)|./g)||[];for(let V=Y.length-1;V>=0;V--){const[W]=Y[V];for(let U=Q.length-1;U>=0;U--)if(Q[U].indexOf(W)!==-1){Q[U]=Q[U].replace(W,Y[V][1]);break}}return this.root.insert(Q,J,Z,this.context,z),Z}buildRegExp(){let $=this.root.buildRegExpStr();if($==="")return[/^$/,[],[]];let J=0;const z=[],Z=[];return $=$.replace(/#(\d+)|@(\d+)|\.\*\$/g,(Y,Q,V)=>{if(typeof Q!=="undefined")return z[++J]=Number(Q),"$()";if(typeof V!=="undefined")return Z[Number(V)]=++J,"";return""}),[new RegExp(`^${$}`),z,Z]}};var n$=function($){return K$[$]??(K$[$]=new RegExp($==="*"?"":`^${$.replace(/\/\*/,"(?:|/.*)")}\$`))},O0=function(){K$={}},M0=function($){const J=new h$,z=[];if($.length===0)return w0;const Z=$.map((X)=>[!/\*|\/:/.test(X[0]),...X]).sort(([X,K],[B,O])=>X?1:B?-1:K.length-O.length),Y={};for(let X=0,K=-1,B=Z.length;X<B;X++){const[O,D,P]=Z[X];if(O)Y[D]=[P.map(([N])=>[N,{}]),d$];else K++;let L;try{L=J.insert(D,K,O)}catch(N){throw N===g?new p(D):N}if(O)continue;z[K]=P.map(([N,E])=>{const i={};E-=1;for(;E>=0;E--){const[m,l]=L[E];i[m]=l}return[N,i]})}const[Q,V,W]=J.buildRegExp();for(let X=0,K=z.length;X<K;X++)for(let B=0,O=z[X].length;B<O;B++){const D=z[X][B]?.[1];if(!D)continue;const P=Object.keys(D);for(let L=0,N=P.length;L<N;L++)D[P[L]]=W[D[P[L]]]}const U=[];for(let X in V)U[X]=z[V[X]];return[Q,U,Y]},k=function($,J){if(!$)return;for(let z of Object.keys($).sort((Z,Y)=>Y.length-Z.length))if(n$(z).test(J))return[...$[z]];return},X$=[w,...n].map(($)=>$.toUpperCase()),d$=[],w0=[/^$/,[],{}],K$={},F$=class{constructor(){this.name="RegExpRouter",this.middleware={[w]:{}},this.routes={[w]:{}}}add($,J,z){var Z;const{middleware:Y,routes:Q}=this;if(!Y||!Q)throw new Error(s);if(X$.indexOf($)===-1)X$.push($);if(!Y[$])[Y,Q].forEach((U)=>{U[$]={},Object.keys(U[w]).forEach((X)=>{U[$][X]=[...U[w][X]]})});if(J==="/*")J="*";const V=(J.match(/\/:/g)||[]).length;if(/\*$/.test(J)){const U=n$(J);if($===w)Object.keys(Y).forEach((X)=>{var K;(K=Y[X])[J]||(K[J]=k(Y[X],J)||k(Y[w],J)||[])});else(Z=Y[$])[J]||(Z[J]=k(Y[$],J)||k(Y[w],J)||[]);Object.keys(Y).forEach((X)=>{if($===w||$===X)Object.keys(Y[X]).forEach((K)=>{U.test(K)&&Y[X][K].push([z,V])})}),Object.keys(Q).forEach((X)=>{if($===w||$===X)Object.keys(Q[X]).forEach((K)=>U.test(K)&&Q[X][K].push([z,V]))});return}const W=d(J)||[J];for(let U=0,X=W.length;U<X;U++){const K=W[U];Object.keys(Q).forEach((B)=>{var O;if($===w||$===B)(O=Q[B])[K]||(O[K]=[...k(Y[B],K)||k(Y[w],K)||[]]),Q[B][K].push([z,V-X+U+1])})}}match($,J){O0();const z=this.buildAllMatchers();return this.match=(Z,Y)=>{const Q=z[Z],V=Q[2][Y];if(V)return V;const W=Y.match(Q[0]);if(!W)return[[],d$];const U=W.indexOf("",1);return[Q[1][U],W]},this.match($,J)}buildAllMatchers(){const $={};return X$.forEach((J)=>{$[J]=this.buildMatcher(J)||$[w]}),this.middleware=this.routes=void 0,$}buildMatcher($){const J=[];let z=$===w;if([this.middleware,this.routes].forEach((Z)=>{const Y=Z[$]?Object.keys(Z[$]).map((Q)=>[Q,Z[$][Q]]):[];if(Y.length!==0)z||(z=!0),J.push(...Y);else if($!==w)J.push(...Object.keys(Z[w]).map((Q)=>[Q,Z[w][Q]]))}),!z)return null;else return M0(J)}};var B$=class{constructor($){this.name="SmartRouter",this.routers=[],this.routes=[],Object.assign(this,$)}add($,J,z){if(!this.routes)throw new Error(s);this.routes.push([$,J,z])}match($,J){if(!this.routes)throw new Error("Fatal error");const{routers:z,routes:Z}=this,Y=z.length;let Q=0,V;for(;Q<Y;Q++){const W=z[Q];try{Z.forEach((U)=>{W.add(...U)}),V=W.match($,J)}catch(U){if(U instanceof p)continue;throw U}this.match=W.match.bind(W),this.routers=[W],this.routes=void 0;break}if(Q===Y)throw new Error("Fatal error");return this.name=`SmartRouter + ${this.activeRouter.name}`,V}get activeRouter(){if(this.routes||this.routers.length!==1)throw new Error("No active router has been determined yet.");return this.routers[0]}};var q$=class{constructor($,J,z){if(this.order=0,this.params={},this.children=z||{},this.methods=[],this.name="",$&&J){const Z={};Z[$]={handler:J,possibleKeys:[],score:0,name:this.name},this.methods=[Z]}this.patterns=[]}insert($,J,z){this.name=`${$} ${J}`,this.order=++this.order;let Z=this;const Y=N$(J),Q=[],V=[];for(let X=0,K=Y.length;X<K;X++){const B=Y[X];if(Object.keys(Z.children).includes(B)){V.push(...Z.patterns),Z=Z.children[B];const D=z$(B);if(D)Q.push(D[1]);continue}Z.children[B]=new q$;const O=z$(B);if(O)Z.patterns.push(O),V.push(...Z.patterns),Q.push(O[1]);V.push(...Z.patterns),Z=Z.children[B]}if(!Z.methods.length)Z.methods=[];const W={},U={handler:z,possibleKeys:Q.filter((X,K,B)=>B.indexOf(X)===K),name:this.name,score:this.order};return W[$]=U,Z.methods.push(W),Z}gHSets($,J,z,Z){const Y=[];for(let Q=0,V=$.methods.length;Q<V;Q++){const W=$.methods[Q],U=W[J]||W[w],X={};if(U!==void 0)U.params={},U.possibleKeys.forEach((K)=>{const B=X[U.name];U.params[K]=Z[K]&&!B?Z[K]:z[K]??Z[K],X[U.name]=!0}),Y.push(U)}return Y}search($,J){const z=[];this.params={};const Z={};let Q=[this];const V=Z$(J);for(let U=0,X=V.length;U<X;U++){const K=V[U],B=U===X-1,O=[];for(let D=0,P=Q.length;D<P;D++){const L=Q[D],N=L.children[K];if(N)if(N.params=L.params,B===!0){if(N.children["*"])z.push(...this.gHSets(N.children["*"],$,L.params,{}));z.push(...this.gHSets(N,$,L.params,{}))}else O.push(N);for(let E=0,i=L.patterns.length;E<i;E++){const m=L.patterns[E];if(m==="*"){const e=L.children["*"];if(e)z.push(...this.gHSets(e,$,L.params,{})),O.push(e);continue}if(K==="")continue;const[l,M$,b]=m,f=L.children[l],L$=V.slice(U).join("/");if(b instanceof RegExp&&b.test(L$)){Z[M$]=L$,z.push(...this.gHSets(f,$,L.params,Z));continue}if(b===!0||b instanceof RegExp&&b.test(K)){if(typeof l==="string")if(Z[M$]=K,B===!0){if(z.push(...this.gHSets(f,$,Z,L.params)),f.children["*"])z.push(...this.gHSets(f.children["*"],$,L.params,Z))}else f.params={...Z},O.push(f)}}}Q=O}return[z.sort((U,X)=>{return U.score-X.score}).map(({handler:U,params:X})=>[U,X])]}};var w$=class{constructor(){this.name="TrieRouter",this.node=new q$}add($,J,z){const Z=d(J);if(Z){for(let Y of Z)this.node.insert($,Y,z);return}this.node.insert($,J,z)}match($,J){return this.node.search($,J)}};var O$=class extends l${constructor($={}){super($);this.router=$.router??new B$({routers:[new F$,new w$]})}};var t=new O$,L0=t.basePath("/api");L0.post("/",async($)=>{const J=(await $.req.formData()).get("username");if(typeof J==="string")return $.json({res:J.toUpperCase()})});t.use("*",$$({root:"../build"}));var r1=t;export{r1 as default};
